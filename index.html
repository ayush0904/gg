<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday â€” Neha ğŸ€ğŸ’ªğŸš—ğŸ‘©â€ğŸ³</title>
  <!-- Elegant, friendly type pairing -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Quicksand:wght@500;600;700&family=Patrick+Hand&display=swap" rel="stylesheet">
  <style>
    /* ===================== THEME ===================== */
    :root{
      /* Harmonized pastel palette with better contrast */
      --ink:#26252a;            /* primary text */
      --muted:#6c6a74;          /* secondary text */
      --card:#ffffff;           /* surfaces */

      /* Pastel accents (HSL for smoother tweens) */
      --pink: hsl(343 100% 90%);
      --blush:hsl(340 100% 97%);
      --lav:  hsl(265 100% 92%);
      --mint: hsl(164 100% 90%);
      --sun:  hsl(48  100% 90%);

      /* Brand accents */
      --accent: hsl(345 93% 69%);   /* strawberry */
      --accent2:hsl(257 86% 72%);   /* lilac */
      --accent3:hsl(166 69% 66%);   /* mint */

      /* Shadows */
      --shadow-lg: 0 18px 48px rgba(20,18,25,.12), 0 2px 6px rgba(20,18,25,.06);
      --shadow-sm: 0 8px 22px rgba(20,18,25,.10);

      /* Radii */
      --r-lg: 22px;
      --r-pill: 999px;
    }

    /* ===================== BASE ===================== */
    html,body{height:100%}
    *{box-sizing:border-box}

    body{
      display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0;
      color:var(--ink);
      font-family: "Plus Jakarta Sans", ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      overflow:hidden; perspective:1000px;
      background:
        radial-gradient(1200px 700px at 10% 10%, var(--sun), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, var(--mint), transparent 60%),
        radial-gradient(800px 600px at 10% 90%, var(--lav), transparent 60%),
        linear-gradient(135deg, var(--pink), var(--blush));
      animation:bgShift 18s ease-in-out infinite alternate;
    }
    @keyframes bgShift{ 0%{filter:hue-rotate(0) saturate(1)} 100%{filter:hue-rotate(10deg) saturate(1.05)} }

    /* Decorative soft texture */
    body:before{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
      background:radial-gradient(60px 60px at 30% 20%, rgba(255,255,255,.15), transparent 60%),
                 radial-gradient(60px 60px at 70% 80%, rgba(255,255,255,.12), transparent 60%);
      mix-blend-mode:soft-light;
    }

    /* ===================== BACKGROUND COOKING ITEMS ===================== */
    .bg-cooking{position:fixed; font-size:34px; opacity:.08; animation:float 14s linear infinite; z-index:-1}
    @keyframes float{0%{opacity:0; transform:translateY(100vh) rotate(0deg) scale(1)}10%{opacity:.18}90%{opacity:.18}100%{opacity:0; transform:translateY(-15vh) rotate(360deg) scale(1.05)}}

    /* ===================== HEADER RIBBON ===================== */
    .ribbon{
      position:fixed; top:12px; left:50%; transform:translateX(-50%);
      background:rgba(255,255,255,.85); backdrop-filter:blur(8px);
      padding:12px 20px; border-radius:var(--r-pill); box-shadow:var(--shadow-sm);
      display:flex; align-items:center; gap:10px; z-index:6;
      border:1px solid rgba(255,255,255,.8);
    }
    .titleText{
      font-weight:800; letter-spacing:.3px;
      background:linear-gradient(90deg,var(--accent),var(--accent2),var(--accent3));
      -webkit-background-clip:text; background-clip:text; color:transparent; font-size:1.14rem;
    }
    .spark{font-size:18px; animation:pulse 2.4s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}


    /* ===================== DECK / CARD ===================== */
    .deck-container{position:relative; width:380px; max-width:92vw; height:520px; margin:78px 16px 16px;}

    .card{
      position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; overflow:hidden;
      cursor:pointer; backface-visibility:hidden; transition:transform .85s cubic-bezier(.16,1,.3,1), box-shadow .2s ease, filter .3s ease;
      border-radius:var(--r-lg);
      box-shadow:var(--shadow-lg);
      /* Subtle gradient surface + classy border */
      border:1.5px solid transparent;
      background:
        linear-gradient(180deg, rgba(255,255,255,.97), rgba(255,255,255,.92)) padding-box,
        conic-gradient(from 160deg, var(--accent) 0 20%, transparent 20% 40%, var(--accent2) 40% 60%, transparent 60% 80%, var(--accent3) 80% 100%) border-box;
      padding:22px 22px 18px;
      filter:saturate(1.02);
    }
    .card:hover{transform:translateX(-2px) translateY(-2px) rotate(.2deg); box-shadow:0 18px 46px rgba(20,18,25,.16)}
    .card:active{transform:translateY(0) scale(.999)}

    .corner{position:absolute; width:46px; height:46px; opacity:.2; display:grid; place-items:center; font-size:26px}
    .tl{top:8px; left:8px; transform:rotate(-20deg)}
    .tr{top:8px; right:8px; transform:rotate(20deg)}
    .bl{bottom:8px; left:8px; transform:rotate(20deg)}
    .br{bottom:8px; right:8px; transform:rotate(-20deg)}

    .title{
      font-family: "Quicksand", system-ui, sans-serif;
      font-weight:700; font-size:1.5rem; line-height:1.1; text-align:center; margin:8px 0 6px;
      background:linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      letter-spacing:.2px;
    }
    .subtitle{font-size:1rem; color:var(--muted); margin:0 0 10px}

    .message{font-size:1.12rem; text-align:center; margin:8px 0 8px; color:var(--ink)}

    /* Handwritten-style comment box with notebook feel */
    .comment{
      width:94%; min-height:56%; max-height:300px; border-radius:14px; padding:14px 14px 16px; color:#3a3940;
      background:
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.86)),
        repeating-linear-gradient(
          180deg,
          transparent 0 26px,
          rgba(255,145,164,.14) 26px 27px
        );
      border:1.5px dashed rgba(255,145,164,.7);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.8);
      font-family: "Patrick Hand", "Comic Sans MS", "Patrick Hand SC", system-ui;
      font-size:20px; line-height:1.45;
      overflow-y:auto;
      overflow-x:hidden;
    }
    
    /* Custom scrollbar for comment box */
    .comment::-webkit-scrollbar{
      width:8px;
    }
    .comment::-webkit-scrollbar-track{
      background:rgba(255,145,164,.1);
      border-radius:4px;
    }
    .comment::-webkit-scrollbar-thumb{
      background:rgba(255,145,164,.4);
      border-radius:4px;
    }
    .comment::-webkit-scrollbar-thumb:hover{
      background:rgba(255,145,164,.6);
    }

    /* VIDEO */
    .videoWrap{
      width:100%;
      max-width:280px;
      height:180px;
      border-radius:12px;
      overflow:hidden;
      box-shadow: var(--shadow-sm);
      margin:8px auto 0;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .videoWrap video{ 
      display:block; 
      width:100%; 
      height:100%;
      object-fit:contain;
      outline:none; 
      border-radius:12px;
    }
    
    /* IMAGE */
    .imageWrap{
      width:100%;
      max-width:280px;
      height:180px;
      border-radius:12px;
      overflow:hidden;
      box-shadow: var(--shadow-sm);
      margin:8px auto 0;
      background:#f8f8f8;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .imageWrap img{ 
      display:block; 
      width:100%; 
      height:100%;
      object-fit:contain;
      outline:none; 
      border-radius:12px; 
    }

    /* Scatter poses */
    .card.r0{transform:translate(-80%, -60%) rotate(-15deg)}
    .card.r1{transform:translate(80%, -60%) rotate(15deg)}
    .card.r2{transform:translate(-80%, 60%) rotate(15deg)}
    .card.r3{transform:translate(80%, 60%) rotate(-15deg)}
    .card.r4{transform:translate(-100%, 0) rotate(-10deg)}
    .card.r5{transform:translate(100%, 0) rotate(10deg)}
    .card.r6{transform:translate(0, -90%) rotate(6deg)}
    .card.r7{transform:translate(0, 90%) rotate(-6deg)}
    .card.r8{transform:translate(-60%, -40%) rotate(8deg)}
    .card.r9{transform:translate(60%, 40%) rotate(-8deg)}

    /* Instructions + Buttons */
    .instructions{position:fixed; bottom:18px; left:50%; transform:translateX(-50%); background:rgba(255,255,255,.92); padding:10px 18px; border-radius:28px; box-shadow:var(--shadow-sm); z-index:5; border:1px solid rgba(255,255,255,.9)}
    .restart{position:fixed; top:18px; right:18px; padding:10px 18px; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#fff; border:none; border-radius:22px; cursor:pointer; font-weight:800; box-shadow:0 8px 20px rgba(181,140,255,.35); z-index:5; letter-spacing:.2px}
    .restart:hover{transform:translateY(-1px)}

    /* Floating hearts & balloons */
    .float{position:absolute; font-size:24px; color:#ff9eb5; animation:up 4.2s ease-in-out infinite; opacity:0}
    @keyframes up{0%{transform:translateY(0); opacity:0} 15%{opacity:.45} 85%{opacity:.45} 100%{transform:translateY(-65px); opacity:0}}

    /* Confetti */
    .confetti{position:fixed; inset:0; pointer-events:none; z-index:2}
    .piece{position:absolute; width:8px; height:14px; background:#ffd1dc; animation:drop 3.8s linear forwards; opacity:.9; border-radius:3px}
    .piece:nth-child(3n){background:#d7fff3}
    .piece:nth-child(4n){background:#e9d7ff}
    .piece:nth-child(5n){background:#fff3c7}
    @keyframes drop{0%{transform:translateY(-10vh) rotate(0)} 100%{transform:translateY(110vh) rotate(540deg)}}

    /* Overlay (start) */
    .overlay{position:fixed; inset:0; background:rgba(255,255,255,.6); backdrop-filter:blur(6px); display:grid; place-items:center; z-index:10}
    .cta{display:flex; flex-direction:column; align-items:center; gap:14px; background:linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.9)); padding:24px 28px; border-radius:24px; box-shadow:var(--shadow-lg); border:1.6px solid #ffe3ea; text-align:center; animation:pop .8s ease both}
    .cta h1{margin:0; font-size:1.35rem; font-weight:800}
    .cta .big{font-size:2rem}
    .cta button{border:none; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#fff; font-weight:900; padding:12px 20px; border-radius:var(--r-pill); cursor:pointer; box-shadow:0 12px 30px rgba(181,140,255,.3)}
    .cta button:hover{transform:translateY(-1px)}
    @keyframes pop{0%{transform:scale(.95); opacity:0}100%{transform:scale(1); opacity:1}}

    /* Music HUD */
    .hud{position:fixed; bottom:14px; right:14px; z-index:6; display:flex; gap:8px; align-items:center}
    .hud button{border:none; background:#fff; border-radius:var(--r-pill); padding:10px 12px; box-shadow:var(--shadow-sm); cursor:pointer}
    .notes{position:fixed; right:24px; bottom:64px; pointer-events:none}
    .note{position:absolute; font-size:18px; opacity:0; animation:noteUp 2.2s linear forwards}
    @keyframes noteUp{0%{transform:translateY(0) translateX(0) rotate(0); opacity:0}20%{opacity:1}100%{transform:translateY(-80px) translateX(-20px) rotate(30deg); opacity:0}}

    /* 3D tilt */
    .tilt{transform-style:preserve-3d}

    /* Stickers */
    .sticker{position:fixed; font-size:28px; opacity:.9; animation:drift 9s ease-in-out infinite alternate; pointer-events:none}
    .sticker.s1{left:6vw; top:70vh}
    .sticker.s2{right:8vw; top:22vh}
    .sticker.s3{left:12vw; top:18vh}
    @keyframes drift{0%{transform:translateY(0)}100%{transform:translateY(-12px)}}

    /* Active card glow */
    .card.is-top{box-shadow:0 22px 60px rgba(181,140,255,.28), 0 6px 18px rgba(20,18,25,.06)}

    /* Reduced motion accessibility */
    @media (prefers-reduced-motion: reduce){
      *{animation:none!important; transition:none!important}
    }

    /* Mobile tweaks */
    @media (max-width:480px){
      .deck-container{height:500px}
      .title{font-size:1.32rem}
      .comment{font-size:18px}
      .ribbon{padding:10px 16px}
      .titleText{font-size:1.02rem}
    }
  </style>
</head>
<body>
  <!-- Background shuttlecocks -->
  <div id="bg"></div>

  <!-- Soft stickers -->
  <div class="sticker s1">ğŸ’</div>
  <div class="sticker s2">â­ï¸</div>
  <div class="sticker s3">ğŸ«¶</div>

  <div class="confetti" id="confetti"></div>

  <div class="ribbon" role="banner"><span class="spark" aria-hidden="true">âœ¨</span><span class="titleText">Happy Birthday, Neha! ğŸ‚ğŸ’ªğŸš—ğŸ‘©â€ğŸ³</span><span class="spark" aria-hidden="true">âœ¨</span></div>

  <!-- Deck -->
  <div class="deck-container tilt" id="deck" aria-live="polite"></div>
  <button class="restart" onclick="restartDeck()" aria-label="Reset deck">Reset Deck</button>
  <div class="instructions">Tap the top card to scatter the wishes & start the party! ğŸ‰</div>

  <div class="overlay" id="overlay" aria-modal="true" role="dialog">
    <div class="cta">
      <div class="big" aria-hidden="true">ğŸ€ğŸ¶</div>
      <h1>Tap to start the birthday party!</h1>
      <button id="startBtn" aria-label="Play music and start">Play</button>
    </div>
  </div>

  <!-- Music HUD -->
  <div class="hud" aria-live="polite">
    <button id="toggleMusic" title="Toggle music" aria-label="Toggle music">ğŸ”ˆ</button>
    <div class="notes" id="notes"></div>
  </div>

  <script>
    /* ===================== DATA ===================== */
    const wishes = [
      { title: "ğŸ’ªğŸ’ªğŸ’ª Triple Strength Birthday! ğŸ€", subtitle: "From all of us", message: "To our favorite gym-loving, food-making, adventure-taking girl â€”Youâ€™re basically a protein shake with a heart of Nutella â¤ï¸ Keep lifting, cooking, and flying your way through another amazing year âœˆï¸ğŸ’ª" },
      { title: "Gym Buddy Forever ğŸ’ª", subtitle: "Tanaya", comment: "A very very happy birthday Neha!!! Ten years of friendship and counting - cheers to many more gym sessions and road trips!!!" },
      { title: "Driving Adventures ğŸš—", subtitle: "Nilesh",  comment: "Happy Birthday Neha. Thanks for all those 'useless' chocolates from the US . This year, try keeping in touch throughout the year, not just in December when you suddenly remember we exist. And let's plan more road trips!" },
      { title: "Chef's Special ğŸ³", subtitle: "Ankita",  comment: "Hey bro, Happy Birthday, thank you for being there for me in my ups and down. I wish you all the happiness in the world. Keep rocking in the gym, on the road, and in the kitchen!!" },
      { title: "Fitness Journey ğŸ‹ï¸â€â™€ï¸", subtitle: "Gauri",  comment: "Happiest Birthday, Neha! It's been 10 years of knowing you, and honestly, I couldn't be luckier! I know I can call you at 3 AM and you'll still pick up and do whatever you can to help me out. Engineering ke days were the best only because you were there ğŸ˜. My first impression tho tha ki 'yeh ladki thodi arrogant hai' ğŸ˜ğŸ˜‚ (aur yeh tujhe bhi pata hai)â€¦ but then you flipped it all around and became my bestest friend ever â¤ï¸ And the rest, as they say, is history. You're the one jiske liye meri mom bolti thi â€” 'Agar Neha aa rahi hai toh jaa' ğŸ˜… She literally had more confidence in you than in me â€” ki 'Neha sab manage karegi'. And now, as I'm growing older, I realise ki aisi dosti milna is such a rare thingâ€¦ and I got super lucky. I always always wait for you to come to India so I can finally meet you and dump all the gossip I've been saving ğŸ¤­ You're one of my constants â€” my go-to person for anything and everything. We've literally grown through every phase together â€” lecture bunk karna, eksaath exam ki prep karna, chai peene jana, fests & festivals celebrate karna, job tensions, friendship stress, ghoomna, rona, hasna â€” and now even finding our life partners ( ye wala tera baki haiğŸ˜‡ ) And honestly, I feel sooo lucky that all these phases of my abh tak ki life had you in them. And aage bhi aisa hi hoga. Nehaaaa, I love you and you know this ğŸ˜˜ Have the most amazing day! Can't wait for our next meet-up & gossip session" },
      { title: "Road Trip Memories ğŸš—", subtitle: "Shyam and Thara",  comment: "Hi Neha, Wishing you a very happy birthday ğŸ‚ğŸ‚ May the coming year be filled with fun, eventful and everlasting memories for you to cherish!!Keep exploring âœ¨âœ¨" },
      { title: "Kitchen Master ğŸ‘©â€ğŸ³", subtitle: "Ayush", comment: "Happy birthday bro!!!!!" },
    //   { title: "Power Workout of Love ğŸ’ª", subtitle: "",  comment: "" },
    //   { title: "First Gym Day Memories ğŸ€", subtitle: "", comment: "" },
    //   { title: "Smiley Gym Partner ğŸ’ª", subtitle: "",  comment: "" },
    //   { title: "Endurance Training ğŸ€", subtitle: "",  comment: "" },
    //   { 
    //     title: "Driving Marathon ğŸš—ğŸ˜‚", 
    //     subtitle: "", 
    //     comment: " ğŸš—ğŸ˜œ" 
    //     },
    //   { title: "Grand Champion of Wishes ğŸ’ªğŸš—ğŸ‘©â€ğŸ³ğŸ€", subtitle: "", comment: "" },
      
      // === IMAGE CARDS ===
      { title: "Beautiful Memories ğŸ“¸", subtitle: "", message: "Some beautiful moments captured! ğŸ«¶", image: { src: "girl1.jpeg", alt: "Beautiful moment" } },
      { title: "More Memories ğŸ“¸", subtitle: "", message: "More beautiful moments! ğŸ«¶", image: { src: "girl2.jpeg", alt: "Another beautiful moment" } },
      
      // === VIDEO CARDS ===
      { title: "Priyanka's Special Message ğŸ¥", subtitle: "Priyanka", message: "A special birthday message from Priyanka! ğŸ«¶", video: { src: "priyanka.mp4" } },
      { title: "Valay's Birthday Wishes ğŸ¥", subtitle: "Valay", message: "Birthday wishes from Valay! ğŸ«¶", video: { src: "valay.mp4" } }
    ];

    /* ===================== UTILS ===================== */
    function el(tag, cls){ const d=document.createElement(tag); if(cls) d.className=cls; return d; }

    /* ===================== BG SHUTTLES ===================== */
    function spawnThemeItems(){
      const bg=document.getElementById('bg'); bg.innerHTML='';
      const COUNT = 15;
      const themeEmojis = ['ğŸ’ª', 'ğŸ‹ï¸â€â™€ï¸', 'ğŸƒâ€â™€ï¸', 'ğŸš—', 'ğŸš™', 'ğŸš—', 'ğŸ‘©â€ğŸ³', 'ğŸ³', 'ğŸ¥„', 'ğŸ§', 'ğŸ°', 'ğŸ¥§', 'ğŸª', 'ğŸ¥–', 'ğŸ', 'ğŸ¥'];
      for(let i=0;i<COUNT;i++){
        const s=el('div','bg-cooking'); s.textContent=themeEmojis[Math.floor(Math.random()*themeEmojis.length)];
        s.style.left=Math.random()*100+'vw';
        s.style.animationDelay=(Math.random()*10)+'s';
        s.style.fontSize=(30 + Math.random()*16)+'px';
        bg.appendChild(s);
      }
    }

    /* ===================== CONFETTI ===================== */
    function popConfetti(){
      const c=document.getElementById('confetti'); c.innerHTML='';
      const N=40; const w=window.innerWidth;
      for(let i=0;i<N;i++){
        const p=el('span','piece');
        p.style.left=Math.random()*w+'px';
        p.style.top=(-20 - Math.random()*60)+'px';
        p.style.animationDelay=(Math.random()*0.8)+'s';
        p.style.transform=`translateY(-10vh) rotate(${Math.random()*180}deg)`;
        c.appendChild(p);
      }
      setTimeout(()=> c.innerHTML='', 4000);
    }


    /* ===================== HEARTS ===================== */
    function floatingHearts(){
      let hearts='';
      for(let i=0;i<3;i++){
        const delay=Math.random()*3; const left=20 + Math.random()*60;
        const emoji = Math.random()>.5 ? 'ğŸ’–' : 'ğŸ’';
        hearts += `<div class="float" style="left:${left}%; animation-delay:${delay}s">${emoji}</div>`;
      }
      return hearts;
    }

    /* ===================== SPARKLE BURST ===================== */
    function sparkleBurst(x,y){
      const k=8;
      for(let i=0;i<k;i++){
        const s=el('div'); s.textContent=['âœ¨','âœ¦','â­ï¸'][i%3]; s.style.position='fixed'; s.style.left=x+'px'; s.style.top=y+'px'; s.style.opacity='0.9'; s.style.pointerEvents='none'; s.style.transition='transform 600ms ease, opacity 600ms ease'; s.style.zIndex=9;
        document.body.appendChild(s);
        const ang = (Math.PI*2)*(i/k); const dist = 24 + Math.random()*18;
        requestAnimationFrame(()=>{
          s.style.transform=`translate(${Math.cos(ang)*dist}px, ${Math.sin(ang)*dist}px)`; s.style.opacity='0';
        });
        setTimeout(()=> s.remove(), 650);
      }
    }

    /* ===================== DECK ===================== */
    function buildDeck(){
      const deck=document.getElementById('deck'); deck.innerHTML='';
      wishes.forEach((w,idx)=>{
        const card=el('div','card'); card.style.zIndex=wishes.length-idx;
        const t=el('div','corner tl'); t.textContent='ğŸ’ª';
        const tr=el('div','corner tr'); tr.textContent='ğŸ€';
        const bl=el('div','corner bl'); bl.textContent='ğŸš—';
        const br=el('div','corner br'); br.textContent='ğŸ‚';
        card.append(t,tr,bl,br);

        let inner='';
        inner += `<h2 class="title">${w.title}</h2>`;
        if(w.subtitle){ inner += `<p class="subtitle">${w.subtitle}</p>`; }
        if(w.message){ inner += `<p class="message">${w.message}</p>`; }
        if(w.comment){ inner += `<div class="comment">${w.comment}</div>`; }

        // --- IMAGE ---
        if (w.image && w.image.src){
          inner += `
            <div class="imageWrap">
              <img src="${w.image.src}" alt="${w.image.alt || 'Image'}" />
            </div>
          `;
        }
        
        // --- VIDEO ---
        if (w.video && w.video.src){
          inner += `
            <div class="videoWrap">
              <video ${w.video.poster ? `poster="${w.video.poster}"` : ""} playsinline muted controls preload="metadata">
                <source src="${w.video.src}" type="video/mp4" />
                Your browser does not support the video tag.
              </video>
            </div>
          `;
        }

        inner += floatingHearts();
        card.insertAdjacentHTML('beforeend', inner);

        // Click behavior: scatter for all cards
        card.addEventListener('click', function(ev){
          const cards=[...document.querySelectorAll('.card')];
          const top=Math.max(...cards.map(c=>parseInt(c.style.zIndex)));
          if(parseInt(this.style.zIndex)===top){
            this.classList.add('r'+(idx%10)); this.style.zIndex=1; popConfetti();
            sparkleBurst(ev.clientX, ev.clientY);
            if(!musicStarted){ startMusic(); showNotesBurst(); }
            markTopCard();
          }
        });
        
        // Video-specific behavior: soften/restore background music when playing
        if (w.video && w.video.src){
          const vidObserver = new MutationObserver(()=>{
            const vid = card.querySelector('video');
            if(vid){
              vid.addEventListener('play', ()=>{ if (master) master.gain.value = 0; });
              vid.addEventListener('pause', ()=>{ if (!isMuted && master) master.gain.value = 0.16; });
              vid.addEventListener('ended', ()=>{ if (!isMuted && master) master.gain.value = 0.16; });
              vidObserver.disconnect();
            }
          });
          vidObserver.observe(card, { childList:true, subtree:true });
        }

        deck.appendChild(card);
      });
      markTopCard();
    }

    function markTopCard(){
      const cards=[...document.querySelectorAll('.card')];
      const topZ = Math.max(...cards.map(c=>parseInt(c.style.zIndex)));
      cards.forEach(c=>c.classList.toggle('is-top', parseInt(c.style.zIndex)===topZ));
    }

    function restartDeck(){ buildDeck(); spawnThemeItems(); }

    // 3D tilt
    (function(){
      const tiltEl = document.querySelector('.tilt');
      window.addEventListener('mousemove', (e)=>{
        const x=(e.clientX/window.innerWidth - .5)*8;
        const y=(e.clientY/window.innerHeight - .5)*-8;
        tiltEl.style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
      });
    })();

    /* ===================== MUSIC ===================== */
    let audioCtx, master, musicStarted=false, isMuted=false;
    const melody = [
      ['G4',0.5],['G4',0.5],['A4',1],['G4',1],['C5',1],['B4',2],
      ['G4',0.5],['G4',0.5],['A4',1],['G4',1],['D5',1],['C5',2],
      ['G4',0.5],['G4',0.5],['G5',1],['E5',1],['C5',1],['B4',1],['A4',1],
      ['F5',0.5],['F5',0.5],['E5',1],['C5',1],['D5',1],['C5',2]
    ];
    const tempo = 108;

    function freqOf(note){
      const A4=440; const map={'C':-9,'C#':-8,'Db':-8,'D':-7,'D#':-6,'Eb':-6,'E':-5,'F':-4,'F#':-3,'Gb':-3,'G':-2,'G#':-1,'Ab':-1,'A':0,'A#':1,'Bb':1,'B':2};
      const m=/([A-G]#?b?)(\d)/.exec(note); if(!m) return 0; const n=m[1], o=+m[2]; const semis=map[n] + (o-4)*12; return A4*Math.pow(2, semis/12);
    }

    function startAudio(){
      if(!audioCtx){ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); master=audioCtx.createGain(); master.gain.value=.16; master.connect(audioCtx.destination); }
    }

    function playNoteAt(freq, when, dur){
      const o=audioCtx.createOscillator(); const g=audioCtx.createGain();
      o.type='triangle'; o.frequency.value=freq; o.connect(g); g.connect(master);
      g.gain.setValueAtTime(0, when);
      g.gain.linearRampToValueAtTime(0.9, when+0.01);
      g.gain.linearRampToValueAtTime(0.0001, when+dur*0.92);
      o.start(when); o.stop(when+dur);
    }

    let loopId;
    function startMusic(){
      startAudio(); musicStarted=true; const beat = 60/tempo; let t=audioCtx.currentTime + .05;
      melody.forEach(([n,len])=>{ playNoteAt(freqOf(n), t, len*beat); t += len*beat; });
      const total = melody.reduce((s, [,l])=>s+l,0) * beat;
      loopId = setInterval(()=>{
        if(!isMuted){
          let t=audioCtx.currentTime + .05; melody.forEach(([n,len])=>{ playNoteAt(freqOf(n), t, len*beat); t += len*beat; });
          showNotesBurst();
        }
      }, (total+0.8)*1000);
    }

    function toggleMusic(){
      if(!musicStarted){ startMusic(); return }
      isMuted = !isMuted; master.gain.value = isMuted ? 0 : .16; document.getElementById('toggleMusic').textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”ˆ';
      showNotesBurst();
    }

    function showNotesBurst(){
      const holder=document.getElementById('notes');
      for(let i=0;i<5;i++){
        const n=el('div','note'); n.textContent = ['â™ª','â™©','â™«','â™¬'][Math.floor(Math.random()*4)];
        n.style.left = (Math.random()*6)+'px'; n.style.animationDelay = (Math.random()*0.2)+'s'; holder.appendChild(n);
        setTimeout(()=> n.remove(), 2200);
      }
    }

    document.getElementById('toggleMusic').addEventListener('click', toggleMusic);

    // Overlay start
    document.getElementById('startBtn').addEventListener('click', ()=>{
      document.getElementById('overlay').style.display='none';
      startMusic(); popConfetti(); showNotesBurst();
    });

    // Also start on first card tap
    window.addEventListener('pointerdown', ()=>{
      if(!musicStarted && document.getElementById('overlay').style.display!=='none'){
        document.getElementById('overlay').style.display='none';
        startMusic(); showNotesBurst();
      }
    }, { once:true });

    /* ===================== INIT ===================== */
    function init(){ spawnThemeItems(); buildDeck(); }
    init();

    // Bigger balloons at intervals
    setInterval(()=> {
      const heart=el('div','float');
      heart.textContent = Math.random()>.5 ? 'ğŸˆ' : 'ğŸ’–';
      heart.style.left = (20+Math.random()*60)+'%';
      heart.style.top = '72%';
      heart.style.animationDuration = (3.6 + Math.random()*1.4)+'s';
      document.body.appendChild(heart);
      setTimeout(()=> heart.remove(), 4200);
    }, 1800);
  </script>
</body>
</html>